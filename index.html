<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Растения против Зомби (Упрощённая версия)</title>
    <style>
        body { margin: 0; background: #333; display: flex; justify-content: center; align-items: center; height: 100vh; }
        canvas { border: 2px solid #000; background: #90ee90; } /* Зелёный газон */
        #ui { position: absolute; top: 10px; left: 10px; color: white; font-family: Arial; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="900" height="500"></canvas>
    <div id="ui">
        <p>Солнце: <span id="sunCount">50</span></p>
        <p>Выберите растение: <button onclick="selectPlant('sunflower')">Подсолнух (50)</button> <button onclick="selectPlant('peashooter')">Горохострел (100)</button></p>
        <p>Статус: <span id="status">Игра начата!</span></p>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 100; // Размер клетки (5 рядов x 9 колонок)
        const rows = 5, cols = 9;
        let sun = 50; // Начальное солнце
        let selectedPlant = null;
        let plants = []; // Массив растений
        let zombies = []; // Массив зомби
        let projectiles = []; // Снаряды (горохи)
        let suns = []; // Падающее солнце
        let gameOver = false;
        let level = 1; // Уровень (волны зомби)

        // Классы для объектов
        class Plant {
            constructor(type, x, y) {
                this.type = type;
                this.x = x;
                this.y = y;
                this.health = 100;
                this.lastShot = 0; // Для горохострела
                this.lastSun = 0; // Для подсолнуха
            }
            draw() {
                ctx.fillStyle = this.type === 'sunflower' ? 'yellow' : 'green';
                ctx.fillRect(this.x, this.y, gridSize - 10, gridSize - 10);
                ctx.fillStyle = 'black';
                ctx.fillText(this.type, this.x + 10, this.y + 50);
            }
            update() {
                if (this.type === 'sunflower' && Date.now() - this.lastSun > 10000) { // Солнце каждые 10 сек
                    suns.push({x: this.x + 20, y: this.y + 20, falling: false});
                    this.lastSun = Date.now();
                }
                if (this.type === 'peashooter' && Date.now() - this.lastShot > 2000) { // Стрельба каждые 2 сек
                    let targetZombie = zombies.find(z => z.row === Math.floor(this.y / gridSize) && z.x > this.x);
                    if (targetZombie) {
                        projectiles.push({x: this.x + gridSize, y: this.y + 40, row: Math.floor(this.y / gridSize)});
                        this.lastShot = Date.now();
                    }
                }
            }
        }

        class Zombie {
            constructor(row) {
                this.x = canvas.width - 50;
                this.y = row * gridSize + 20;
                this.row = row;
                this.health = 100;
                this.speed = 1;
            }
            draw() {
                ctx.fillStyle = 'gray';
                ctx.fillRect(this.x, this.y, 50, 80);
                ctx.fillStyle = 'black';
                ctx.fillText('Zombie', this.x + 5, this.y + 40);
            }
            update() {
                this.x -= this.speed;
                // Атака растений
                let plant = plants.find(p => Math.floor(p.y / gridSize) === this.row && Math.abs(p.x - this.x) < gridSize);
                if (plant) {
                    plant.health -= 1;
                    if (plant.health <= 0) plants = plants.filter(p => p !== plant);
                }
                if (this.x < 0) gameOver = true; // Зомби дошёл до дома
            }
        }

        class Projectile {
            constructor(x, y, row) {
                this.x = x;
                this.y = y;
                this.row = row;
                this.speed = 5;
            }
            draw() {
                ctx.fillStyle = 'lime';
                ctx.fillRect(this.x, this.y, 20, 10);
            }
            update() {
                this.x += this.speed;
                let zombie = zombies.find(z => z.row === this.row && Math.abs(z.x - this.x) < 30);
                if (zombie) {
                    zombie.health -= 20;
                    if (zombie.health <= 0) zombies = zombies.filter(z => z !== zombie);
                    projectiles = projectiles.filter(p => p !== this);
                }
                if (this.x > canvas.width) projectiles = projectiles.filter(p => p !== this);
            }
        }

        // Падающее солнце
        function spawnSun() {
            suns.push({x: Math.random() * canvas.width, y: 0, falling: true});
        }

        // Обновление UI
        function updateUI() {
            document.getElementById('sunCount').innerText = sun;
            document.getElementById('status').innerText = gameOver ? 'Игра окончена! (Перезагрузите страницу)' : `Уровень ${level}`;
        }

        // Выбор растения
        function selectPlant(type) {
            selectedPlant = type;
        }

        // Клик по canvas (размещение растения или сбор солнца)
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX - rect.left;
            const my = e.clientY - rect.top;
            const gridX = Math.floor(mx / gridSize) * gridSize;
            const gridY = Math.floor(my / gridSize) * gridSize;

            // Сбор солнца
            let collectedSun = suns.find(s => Math.abs(s.x - mx) < 20 && Math.abs(s.y - my) < 20);
            if (collectedSun) {
                sun += 25;
                suns = suns.filter(s => s !== collectedSun);
                return;
            }

            // Размещение растения
            if (selectedPlant && !plants.some(p => p.x === gridX && p.y === gridY)) {
                let cost = selectedPlant === 'sunflower' ? 50 : 100;
                if (sun >= cost) {
                    sun -= cost;
                    plants.push(new Plant(selectedPlant, gridX, gridY));
                    selectedPlant = null;
                }
            }
        });

        // Основной игровой цикл
        function gameLoop() {
            if (gameOver) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Рисуем сетку
            for (let i = 0; i < rows; i++) for (let j = 0; j < cols; j++) {
                ctx.strokeRect(j * gridSize, i * gridSize, gridSize, gridSize);
            }

            // Обновляем и рисуем растения
            plants.forEach(p => { p.update(); p.draw(); });

            // Обновляем и рисуем зомби
            zombies.forEach(z => { z.update(); z.draw(); });

            // Обновляем и рисуем снаряды
            projectiles.forEach(p => { p.update(); p.draw(); });

            // Падающее солнце
            suns.forEach(s => {
                if (s.falling) s.y += 2;
                if (s.y > canvas.height) suns = suns.filter(su => su !== s);
                ctx.fillStyle = 'orange';
                ctx.fillRect(s.x, s.y, 20, 20);
            });

            updateUI();

            // Спавн зомби и солнца
            if (Math.random() < 0.01 * level) zombies.push(new Zombie(Math.floor(Math.random() * rows))); // Волны
            if (Math.random() < 0.005) spawnSun();

            // Проверка победы (все зомби мертвы, переходим на уровень)
            if (zombies.length === 0 && Math.random() < 0.01) level++;

            requestAnimationFrame(gameLoop);
        }

        gameLoop(); // Запуск игры
    </script>
</body>
</html>
